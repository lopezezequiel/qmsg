language: python

python:
- '2.7'

branches:
  only:
  - master

env:
  global:
  - DATABASE_NAME=database_name
  - TEST_DATABASE_NAME=test_database_name
  - DATABASE_PASSWORD=database_password
  - DATABASE_USER=database_user
  - DATABASE_HOST=localhost
  - DATABASE_PORT=5432
  - DJANGO_SETTINGS_MODULE=qmsg.settingstravis
  # Browserstack
  - secure: WFMDDyr928betQVbZWwf3VKcNnG3N6kaxeAd9MSMM9SsNoPo+6a+83/7TSC4dLLToBJs5onVmdD0C6W0hpUHi1eo81gw+RCxJS7ZQ3MGJ+cibONkotUmgLY0e9RZX7Kj9b+jXRHxlEEJEo6UmXVlOnTgiYtwGFjJ+ZZ2Gfa8mQF30DLsDOm18p8qXzzuKeid0HhwGx38RJeoZpDfs14Aop0eBLw5B8MRtbm1cnsdDfQOVpN7G5gWrGqC5/E8o9bgt2jMqBes3+tcEOfBGHEPDrm6KO455Qtellcv8qv4UwBCGUkv3SzU48HphXyhM1PLhMcmpoQv1Xdzd1KWiOjS2qS9omaDwbav5uaJ4ZpKBJEytic6Zeia/Kuw+gXXCkqDJVxt9ciumCxqFvPEGcwdT/WjmmSZUPq7blunzkdhF/xh40AcKKS0/VzTzNdR3tVrX19Mo7lDj/q1zQA9L0y5DNFxi51TM+ZV2hPV1wwUEi5Y4flgveoPOSKIAB7SyxNcukHob7inx9kAizNHXjsOkBmtKb1LYNxHMvdqsyo2lX24PFaGny/9o1UIpK+eYZLlp38jnLKTRrRqoCRFwSdaI5cCJ3djPMN0c8+lvXRDkDhDaaCp1SijP/6Zwaqf8KWrvC6RrV9/vahbIb6frY6XtiFxJX3xgSO4etqs43yWZBs=
  - secure: IjJys+qPY3CQVoWY2oaqqMfMaoQ9orPF7ZY4Gm7M9KBpwhoIEClOuHkDY3FBr+X8xY7OI/D3Y2/e0iro2QQ6CodM8JJToC1Zm69miXBjX3SxhCmWkvQVE9vDCzmr0JRX/9yX9sHI92RV7YaSkIJ6qWNGd7vvf1ZvhQj2eAXxtsrjnMwyagiwjyU0f/9i0O8Whvn5AywTcwoO6lgK0V2Z7+BjSquyHFxbNcY72B2OGT4fVBTv607DH4wehUNgVrQPnu+PIHXPG1srSSn2zF8C2pjo+sslW6jywNDhyoFZ8V58TKvW0CX6WA1VgsJp7Gxt+O/OtNkdDrdqNm2jwZ06SGsfgZqYPQB/prjZoip8JQvYvlMH3r7htz4+VHuseuwX2XQuxB7CkxWZz3c4WXqfGsPYMlb6MYeyIZSegy7hkoKf/d5u5B1K2BGYt3RRd2OdgeFE3YGORtzH/ebNZyU4/QvAu5X1W0M5/j/zSgn3PZ4kGfYxk2Z5RB4Q8MEh7Ns2wkr+VJFjcZuWpkGY3eOKSQvKoOwR3lzVxwGqOGSs3vJmOD1JijtyaEn854UU4zHsiKiqW3PFYX+nm+zEwyCirPaNy7tgqELOE+hhz+IhKY+4x+tl0EzgPI0QM7KIbOpDYkUJTqS0WuIUUaDp+kHVKKJTLCJehwg0/37VxvCV4aI=
  # Codeclimate
  - secure: oSfMAJlkEn9P1Yi03bkqx57s6xMhtNzC1SbGE/wj067SqsjrY4BsOtBQZgDnRLQ6W8IkToVMaxuahp+keBHgiXBm9zRwQ4KUzfKW/w1f6SJvDFl+5ELkzb4Jfg/3NsrwS5GtowFGZAbGEH8CJrVZSg9Qke/uh0W6tuM1IfdRBNohYodKGn/PVlyksN9lCJI/Thj9h0mOMrPWv3u1tc2tl2zvFF5Xy0fjz15bFGgND6dN6NpJ43zWVlQySiB1ub27nRYfPEZHbi4Ri61JaI8KTgaQ/ijJTIsZIOqWdaaq/e60GZdcqFx0F5IGrYv4I+34LSIXXWOKKD3H23ZVS9aIkZu5VYsrxXryY3fXwWiL2o+lSeLseSUCK49xy4DpOoBNR+Xy8mVyV93B5EyuCc+s6RW2sSiQAynIM53WFVmKfiqR57yBv3H1uXvJKDWyFfsk/al6ktMYGfEP3eMnzy23UjorD482nVIYkEmkO4gZb/ruHtZsijGqCaLVvUkz/zBXx8XCdBTLFNQdUEbUDRnrUlSxlPQj0Ayjq+iK304RNpUnpeKlBn9Gvkx4joOBgAV8u423NCLwHoxtEabXob/wyr3Zo7zrAbN/EuRqVKvdm0X5ViLOQBDnUtyHTUAzi4xM2Kp4zZkWeVSLc5m4X1ld1guuQUApVJJiGTvDhOIPzdc=
  # Coveralls
  - secure: L95peItGcTAYg2udj0oywfuVOPQ5q5KahsBMUW0Rjj0DQTiJcS9syGOihdJjIC5ZqXKGgdP2hBC60LB46NCHpiQqFTqm8Pn1D525MnMfGR5HaUMQCUWHTYWXn3A7aL9q/mcBLukBKJ2YSci5fzLS5wwQ/sGbgHQgEzwy0iJyyo5ik6+stcR8s1XU95C0yS8XshYE0kelADfIFwnUSqDq2vzu+hQHe4z9Q7eUgkl9FCfXP+PudbybA3Tg3W9vVj1lUoXEwBNuovuCw49UeHOQrOsNQqQa5hapGhtqPOmzHeRR2QWHS/xacjVycSEJC/NPqpXuMKhzAP/Kq8UWZ/8Vtx5xwSa1QRKwD4LCUvej5kZee5SzQAHPDzrzO2g/1H+MjcxgbXcpWDTMgnu8xLdpyJ2yS1yAHMPMe+eI8AUy3LSvmJPkPaQRVCF7WqJ3qhwcGYP6jko3819CW1PsbIF//utoxvrcdvSs2wCCdfOqBFGDTSNpqa/UiH3p9EE54Q/QKej1smT+vpzFSMcBT7Fi8dvdvR3PZut3H9XVkldBi/7K8Z3ycxPIXRqamIPzGpuBjdQyz2g7blfZRIaznBQeTxuHvht38sdI0ydcyTUKqdwcwGmBLgTelAVnNNxKrD9fEW7sIUHpIFY9y7O6fxrtscwOgglaNi313yM1mEumnmQ=
  - RADONFILESENCODING=UTF-8

install:
- pip install -r requirements.txt
- pip install codeclimate-test-reporter

before_script:
- "./scripts/create_database.sh"
- python manage.py migrate
- python manage.py runserver > /dev/null 2>&1 &
- "./drivers/BrowserStackLocal --key $BROWSERSTACK_KEY > /dev/null 2>&1 &"

script:
- pep8 --exclude=migrations apirestv1/
- pyflakes apirestv1/
- radon cc apirestv1/ --min A --exclude "apirestv1/migrations/*" --show-complexity
- coverage run --source=apirestv1 manage.py test

after_success:
- coveralls
- codeclimate-test-reporter

deploy:
  provider: heroku
  api_key:
    secure: YXaqhcdbBA1uVTq6Zgz/at0gn/gTrdTcnfkw7JQfjo8yH5U61l4jpJ//X5KUegyA8JOgcosw9cz42/CuQSKRb4w80vO/fGqQbmvXbzPobc8uLXJPxAXiBzVuNyZyEn3Z37gFGkAKT2FvDGxaXKdMDNsXgRdOEN1U1I3VP9RJeNoXK1LTToKgpr3XlpoJ0HiUKIjahBWPbI//B2n/DZwb7h7uBD0rdlC9i9G3iw77SZQVlwd8vfaElECzI2H8WDjGbNA4sRnfRbwyjRSPCX5uXDV2VCO0MZiC0OE/gOhWpLWCoFWzX2nuLlj6wnWLNyIk9CB3/t9IqC/yVCB5nroD+XS460gJdqN1S87rnFXnTXblhNMKr+ppmyOyhiqqilIRMteT0DMhVK8BK1MjB4y1rq1whgpkoG9n4qPcIlxAxT0sBjtPvg68+bVbc8/kK2z3ppxNhIy8bt0DPByrBw3d5v412ppG/+B7B1uC3zgVDUZEWB/D5GodZbXux83Z2u0MFNlH8kJiPCOLbj1OvikGJnXdcuddyHWvz8gt6isNv1i8LHWnPlpPp0IbNX+6pOhyMN7Zvi1rPd2St57ZQqLzcPqAbku22GwIptPEnv2xDpLmMVPo5B0q3qt6gCdJv2xE4ywYjd0I/6aBGubCBSKg/aB5HhhBmt6U+nBraM5/AYw=
  app: qmsg
  strategy: git
  buildpack: heroku/python
  run:
  - python manage.py migrate

notifications:
  slack:
    secure: X8Qeqnh4hKXLMaY3DOABNYymXVVRSHRyeVWPwJJ1YPz7qyocpz7THK81kNJDjnchsOT8sfHmkgPMcZ+gQ85IezYxiXak/vs3El4I6P95s5bSkxUcxJN1rYyF527sanAPEVMPCXWu00JQeJNlSkE5WRpbRpBBQ+CAtG4KxQV39enbT720p6IS9w03yEwNfa80iMQhJkCMdMjXKO1FN3fRieVZ3G0xw76O6KpImFtVdrN3jKwvYrjVfTcqDOint26Xn7VIfJgGHG1TQWgUDuZgksniYHLxlwWP0rYE94FmyXId1vizvQmOw6d7xDrKtcGxg2EwcKGr8/iAvdCN+55oKGg47TFqIy6nBsDnv2DkOj/07migSvqHQb453knI1L9jun6jCAjC3dJpNGxL6bN44IFAFuwasas06jkVEjwyqS/LEk9BtKlJSHwHdTIqYOTnJDhF/a4Qp0s2aLYQ+xu7oaO4FsvaWiwEh5nOoJ8w8Qlo5mlY1b4fyh7skG+8gv76B25WsNUoQyReFbGrlA5GgZW+1Xd5c+aWm/SUBFRsjedkw/0ctrWqoYxwJqKFV/BAla9GhtK+HeLcbo99pFO+UWNu1BVmWg5u964H20fg2wA/z9pavzruNU8Ha0FeLLx8aS3tstl8Pdi5E0VUb9jjUZRheAgtsgZZRICBg90KP7A=
