language: python

python:
- '2.7'

branches:
  only:
  - master

env:
  global:
  - DATABASE_NAME=database_name
  - TEST_DATABASE_NAME=test_database_name
  - DATABASE_PASSWORD=database_password
  - DATABASE_USER=database_user
  - DATABASE_HOST=localhost
  - DATABASE_PORT=5432
  - DJANGO_SETTINGS_MODULE=qmsg.settingstravis
  # Browserstack
  - secure: AhyYvOZz8LU7+h0BMRPokhV1hz5LLfTV6xJ6fe5Qk4dOrerpu2ZThvgUHdbjPFl1DQoxU1wqKTfOmX+lnlDrOLQOvQQdrZdc8gFpl42OY8AzbNC/90R3WjYGXBYXyEHCBYoZxUY8ydsZg9BCYpsAOZVDHfAIM6FY2P6x24+M/DR/RSYnhOZj4HEjdGu830bBOfeX+SMouuuGY1NBhTaKCY860wf+5WDLH5OWUqf1yo7KOZCuwfPJrH7mASz8RWtu/8rNI1cWB/cYOlsD7P/mnGfNvKoLEWPYUyLR1HuIID0WeEvpu0J0E3TSh7+cJ4eiqB8NSDt64DtB4dUL225CzKi02euHD0RuNvLNaVUMf6PF7OD8oUYhHPiulfoKWLvV6w0M9CsZpT9PGjd4ym7tij5zqPMvXhYowDsLVQ0njmVFx0vtp9mtqQU6R3pH4VLGcbGn38DPhqwIMPOFkT+ndS2qoXBA33/WVauopw/A7t6fzz4kvya3xnsHvonDypLz1Z6Yy8yrAuJ0f60O3QpBljOVVzz6I2VNw+a692aooiGrzV7FRlHeX5PJVFj56hZubVKUABwXG5nC2sMeqPW9evdLPWQqzMObdrqvvvfunbp/KHDcE34IpIX1uUHiU6ojDfZGzQCtVy6o9fmBS4JoyoaJkSD9YyJ9WgV2W1nrVY0=
  - secure: J30pUzZ0MmsrG3UCTtpMSjwG5+Tvb7vgdGzKmHzJTSLDrwTQNxe7AIkJshAHtIl9sN1/7dYdwHg+/m9AaIGcXHx1FJ43neLkCwmJaN/m/17yLMdCTbNzPrx2G5WMUWDNfOEH35m5Y9uEL1PpichAcXdP3UX+fDUFjnFjh00HqQJ3Lv5XxFNI4DZqn3brVQnL+8dPvw743sEKTSyQGFKDBL9lMqJwrAbm8AMjabHfxvT1wOnNYu4wNqqXZscvzx2cB/4EAMm/M96nGYndVKbctI1EaUqpGBm0CakRLbEI1ogo5yU8vFzqkMY2QM3JkdhE2dqPbhP5iW30NrgWIqJODb44ajgrovjEy/NPnr+57NpxHNrRfr/zlsnhZtFCQWMJlBKIFOLOIS4kQfzjdbN9U6Jkog70HVoJpn22JT02+RYKqlHpkAwfOnUKcGKSTgH4QKN/a0ROTLEZrASqlu7sKupqpAgMOXKRORv7BOgD5aoWidbuyXlT6aXwEx7hFUXDYBu0PdQpmnQ7XNOjyAi0l4fhQK7ndAqLHrmRvT3Cbwj5MNeDyiwe3b/xZMQt1Rz1/ViOIka1OjoAhFZ/mvbLit3s7BPHdwmSu/D+IqwUzPW/ntEIgRe8dUacWlSa71mkxJ6YflCETJYZFqoWFNtbEX3CemzlAxTjjVXgajTIZZA=
  # Codeclimate
  - secure: oSfMAJlkEn9P1Yi03bkqx57s6xMhtNzC1SbGE/wj067SqsjrY4BsOtBQZgDnRLQ6W8IkToVMaxuahp+keBHgiXBm9zRwQ4KUzfKW/w1f6SJvDFl+5ELkzb4Jfg/3NsrwS5GtowFGZAbGEH8CJrVZSg9Qke/uh0W6tuM1IfdRBNohYodKGn/PVlyksN9lCJI/Thj9h0mOMrPWv3u1tc2tl2zvFF5Xy0fjz15bFGgND6dN6NpJ43zWVlQySiB1ub27nRYfPEZHbi4Ri61JaI8KTgaQ/ijJTIsZIOqWdaaq/e60GZdcqFx0F5IGrYv4I+34LSIXXWOKKD3H23ZVS9aIkZu5VYsrxXryY3fXwWiL2o+lSeLseSUCK49xy4DpOoBNR+Xy8mVyV93B5EyuCc+s6RW2sSiQAynIM53WFVmKfiqR57yBv3H1uXvJKDWyFfsk/al6ktMYGfEP3eMnzy23UjorD482nVIYkEmkO4gZb/ruHtZsijGqCaLVvUkz/zBXx8XCdBTLFNQdUEbUDRnrUlSxlPQj0Ayjq+iK304RNpUnpeKlBn9Gvkx4joOBgAV8u423NCLwHoxtEabXob/wyr3Zo7zrAbN/EuRqVKvdm0X5ViLOQBDnUtyHTUAzi4xM2Kp4zZkWeVSLc5m4X1ld1guuQUApVJJiGTvDhOIPzdc=
  # Coveralls
  - secure: L95peItGcTAYg2udj0oywfuVOPQ5q5KahsBMUW0Rjj0DQTiJcS9syGOihdJjIC5ZqXKGgdP2hBC60LB46NCHpiQqFTqm8Pn1D525MnMfGR5HaUMQCUWHTYWXn3A7aL9q/mcBLukBKJ2YSci5fzLS5wwQ/sGbgHQgEzwy0iJyyo5ik6+stcR8s1XU95C0yS8XshYE0kelADfIFwnUSqDq2vzu+hQHe4z9Q7eUgkl9FCfXP+PudbybA3Tg3W9vVj1lUoXEwBNuovuCw49UeHOQrOsNQqQa5hapGhtqPOmzHeRR2QWHS/xacjVycSEJC/NPqpXuMKhzAP/Kq8UWZ/8Vtx5xwSa1QRKwD4LCUvej5kZee5SzQAHPDzrzO2g/1H+MjcxgbXcpWDTMgnu8xLdpyJ2yS1yAHMPMe+eI8AUy3LSvmJPkPaQRVCF7WqJ3qhwcGYP6jko3819CW1PsbIF//utoxvrcdvSs2wCCdfOqBFGDTSNpqa/UiH3p9EE54Q/QKej1smT+vpzFSMcBT7Fi8dvdvR3PZut3H9XVkldBi/7K8Z3ycxPIXRqamIPzGpuBjdQyz2g7blfZRIaznBQeTxuHvht38sdI0ydcyTUKqdwcwGmBLgTelAVnNNxKrD9fEW7sIUHpIFY9y7O6fxrtscwOgglaNi313yM1mEumnmQ=
  - RADONFILESENCODING=UTF-8

install:
- pip install -r requirements.txt
- pip install codeclimate-test-reporter

before_script:
- "./scripts/create_database.sh"
- python manage.py migrate
- python manage.py runserver > /dev/null 2>&1 &
- "./drivers/BrowserStackLocal --key $BROWSERSTACK_KEY > /dev/null 2>&1 &"

script:
- pep8 --exclude=migrations apirestv1/
- pyflakes apirestv1/
- radon cc apirestv1/ --min A --exclude "apirestv1/migrations/*" --show-complexity
- coverage run --source=apirestv1 manage.py test

after_success:
- coveralls
- codeclimate-test-reporter

deploy:
  provider: heroku
  api_key:
    secure: YXaqhcdbBA1uVTq6Zgz/at0gn/gTrdTcnfkw7JQfjo8yH5U61l4jpJ//X5KUegyA8JOgcosw9cz42/CuQSKRb4w80vO/fGqQbmvXbzPobc8uLXJPxAXiBzVuNyZyEn3Z37gFGkAKT2FvDGxaXKdMDNsXgRdOEN1U1I3VP9RJeNoXK1LTToKgpr3XlpoJ0HiUKIjahBWPbI//B2n/DZwb7h7uBD0rdlC9i9G3iw77SZQVlwd8vfaElECzI2H8WDjGbNA4sRnfRbwyjRSPCX5uXDV2VCO0MZiC0OE/gOhWpLWCoFWzX2nuLlj6wnWLNyIk9CB3/t9IqC/yVCB5nroD+XS460gJdqN1S87rnFXnTXblhNMKr+ppmyOyhiqqilIRMteT0DMhVK8BK1MjB4y1rq1whgpkoG9n4qPcIlxAxT0sBjtPvg68+bVbc8/kK2z3ppxNhIy8bt0DPByrBw3d5v412ppG/+B7B1uC3zgVDUZEWB/D5GodZbXux83Z2u0MFNlH8kJiPCOLbj1OvikGJnXdcuddyHWvz8gt6isNv1i8LHWnPlpPp0IbNX+6pOhyMN7Zvi1rPd2St57ZQqLzcPqAbku22GwIptPEnv2xDpLmMVPo5B0q3qt6gCdJv2xE4ywYjd0I/6aBGubCBSKg/aB5HhhBmt6U+nBraM5/AYw=
  app: qmsg
  strategy: git
  buildpack: heroku/python
  run:
  - python manage.py migrate

notifications:
  slack:
    secure: Xf7iiHjy4P5GUCN9nYbDcbTuiQ6a2oX3mGhIqe7xym9pDj6KaA71xP6HfENG8wcIEIDxZA5ZU+/bzEx9PPJcIMF/Oe4ub+HjR3c6e89c/ztCVR42HuwUAQPor91F2SYfszJ3CQmpUdR2AXa7pk1vmWd37hLJ4njnMGaMyoInB+pSU89TtYgj7uxUUv6ic2njsHquCaDt3VNGXgRSa1dR3gkON15s/mdjWsONTxsZ0+66t8e17rKimlKdc+ZNlyd++bHXuvjBninmN7ERORtV9sPCMzmLn0Slml9kZONeQU4Kupi5F9BJEbe4mmlE+lTXcMBPwgZ/eCBQbQil3iJUZFN/p7Zl6UB5uF1dFAgIj/61HUaAW03mOqHLPan3KPH1rMl2np/hA8wEddowkkN9Kq0NuUUPDSO7G31Al3+shoK6Kq7AoCwCl+/1asWtNCStu0Q7Mq+axGVnmjXwfSzBE7J0PynKfWiBv1mNNOAJxwTKBEXeZr4tp+idSEnpiNYwDkigGhoUSVP07IH/jJmD67FBScgGr+eM8m+1PYzdyeINZj/Fu3LdKioQtVtPE7vmv2JUKchwFKaXFosEzucAeGVwff7fqChwOwPUYCjv+xpD9lNGESbHV2NyL/h8s0nl1+gg9g4LunuvwthHymGAI6c8t72wrjYDlcSfgVQWOBc=
